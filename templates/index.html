<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BeruAI | Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"/>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css"/>
  <style>
  body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 1;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  background: url('/static/background.png') no-repeat center center fixed;
  background-size: cover;
  opacity: 0.5;
  z-index: -1;
}


  .navbar {
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.5s ease-out;
  }

  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  main {
    flex: 1;
  }

  .container {
    animation: fadeIn 0.7s ease-in;
    max-width: 800px;
    margin: auto;
    padding: 20px;
    width: 100%;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  form {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    animation: bounceIn 0.8s ease;
  }

  @keyframes bounceIn {
    from {
      transform: scale(0.95);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  input.form-control,
  textarea.form-control,
  select.form-select {
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 6px;
    transition: border-color 0.3s ease;
    margin-bottom: 15px;
  }

  input:focus,
  textarea:focus,
  select:focus {
    border-color: #28a745;
    box-shadow: 0 0 0 0.15rem rgba(40, 167, 69, 0.25);
    outline: none;
  }

  .btn-success {
    background: linear-gradient(45deg, #28a745, #218838);
    border: none;
    padding: 10px 20px;
    font-weight: bold;
    transition: background 0.3s ease;
    border-radius: 6px;
    width: 100%;
    max-width: 200px;
    margin: 10px auto;
    display: block;
  }

  .btn-success:hover {
    background: linear-gradient(45deg, #218838, #1e7e34);
  }

  .form-control::placeholder {
    color: #aaa;
    font-style: italic;
  }

  #imageResults img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
    margin-bottom: 15px;
  }

  #imageResults img:hover {
    transform: scale(1.05);
  }

  .fade-in-answer {
    animation: fadeAnswer 0.6s ease-in;
  }

  @keyframes fadeAnswer {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #responseContainer table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    overflow-x: auto;
  }

  #responseContainer th,
  #responseContainer td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
    word-break: break-word;
  }

  #responseContainer th {
    background-color: #e9ecef;
  }

  pre code {
    display: block;
    padding: 1rem;
    border-radius: 8px;
    background-color: #1e1e1e;
    color: #f8f8f2;
    overflow-x: auto;
  }

  footer {
    background: #212529;
    color: #fff;
    text-align: center;
    padding: 10px 0;
    font-size: 14px;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3);
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
  }

  /* Responsive Enhancements */
  @media (max-width: 992px) {
    .container {
      padding: 20px 15px;
    }

    form {
      padding: 20px;
    }

    h2 {
      font-size: 1.75rem;
    }

    .btn-success {
      font-size: 16px;
      padding: 10px 15px;
    }
  }

  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }

    form {
      padding: 15px;
    }

    .navbar .btn {
      font-size: 10px;
      padding: 6px 10px;
    }

    h2 {
      font-size: 1.5rem;
    }

    .btn-success {
      width: 100%;
    }

    footer {
      font-size: 13px;
    }
  }

  @media (max-width: 576px) {
    body {
      font-size: 15px;
    }

    h2 {
      font-size: 1.4rem;
    }

    form {
      padding: 12px;
    }

    input.form-control,
    textarea.form-control,
    select.form-select {
      font-size: 12px;
    }
    span {
      font-size: 12px;
    }

    .btn-success {
      font-size: 12px;
    }

    #responseContainer th,
    #responseContainer td {
      font-size: 13px;
      padding: 6px;
    }
  }
</style>

</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
    <a class="navbar-brand d-flex align-items-center" href="#">
  <img src="/static/Satyen78AI_Logo.png" alt="Logo" style="height: 60px; margin-right: 8px;" />
  <span><b><h5>Satyen78AI</h5></b></span>
</a>
    <div class="ms-auto d-flex align-items-center">
      <span class="text-white me-3">Hi, {{ user_name }}</span>
      <a class="btn btn-outline-light btn-sm me-2" href="/answers">My Answers</a>
      <a class="btn btn-outline-danger btn-sm" href="/logout">Logout</a>
    </div>
  </nav>

  <main class="container py-5">
    <h2 class="mb-4 text-center text-black"><b>Ask Me Anything</b></h2>
    <form id="askForm">
      <div class="mb-3">
        <input id="mainTopic" name="mainTopic" class="form-control" placeholder="Enter main topic..." required />
      </div>
      <div class="mb-3">
        <textarea id="question" name="question" class="form-control" rows="3" placeholder="Enter your subtopic / question..." required></textarea>
      </div>
      <div class="mb-3">
        <select id="style" name="style" class="form-select">
          <option value="easy">Easy English</option>
          <option value="hinglish">Hinglish</option>
          <option value="professional">Professional</option>
          <option value="hindi">Hindi</option>
        </select>
      </div>
      <div class="mb-3">
        <input id="language" name="language" class="form-control" placeholder="Programming Language (Optional): e.g., Python, JavaScript" />
      </div>
      <button type="submit" class="btn btn-success">Generate Answer</button>
    </form>

    <div id="responseContainer" class="mt-5 border rounded p-4 bg-light fade-in-answer" style="min-height: 150px;"></div>

    <div id="imageResults" class="mt-4 d-flex flex-wrap gap-3 justify-content-center"></div>
  </main>

  <!-- Footer -->
  <footer>
    <div>&copy; {{ current_year }} Satyen78AI by Satyendra Kumar Namdeo. All rights reserved.</div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll();

    async function fetchImages(query) {
      const GOOGLE_API_KEY = "AIzaSyDzZQuDnsIgqUDyYhJ77UV9XJ0G-0M2pp0";
      const SEARCH_ENGINE_ID = "b456c73a132774aa1";
      const imageQuery = encodeURIComponent(query + " diagram OR figure OR image");
      const url = `https://www.googleapis.com/customsearch/v1?q=${imageQuery}&cx=${SEARCH_ENGINE_ID}&searchType=image&num=3&key=${GOOGLE_API_KEY}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        return data.items || [];
      } catch (err) {
        console.error("Image fetch error:", err);
        return [];
      }
    }

    function clearImages() {
      document.getElementById("imageResults").innerHTML = "";
    }

    function renderImages(images) {
      const container = document.getElementById("imageResults");
      images.forEach(item => {
        const img = document.createElement("img");
        img.src = item.link;
        img.alt = item.title || "Related image";
        container.appendChild(img);
      });
    }

    document.getElementById("askForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const mainTopic = document.getElementById("mainTopic").value.trim();
      const question = document.getElementById("question").value.trim();
      const style = document.getElementById("style").value;
      const language = document.getElementById("language").value.trim();

      if (!mainTopic || !question) {
        alert("Please enter both Main Topic and Question.");
        return;
      }

      document.getElementById("responseContainer").innerHTML = "Generating answer...";
      clearImages();

      const fullQuestion = `Main topic: ${mainTopic}\nQuestion: ${question}`;
      try {
        const response = await fetch("/api/generate-answer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: fullQuestion, style, language }),
        });

        const data = await response.json();
        if (!response.ok) {
          document.getElementById("responseContainer").innerHTML = `Error: ${data.error || 'Unknown error'}`;
          return;
        }

        document.getElementById("responseContainer").innerHTML = marked.parse(data.answer);
        hljs.highlightAll();

        // Save the answer
        try {
          await fetch("/api/save-answer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question: fullQuestion, answer: data.answer }),
          });
        } catch (err) {
          console.warn("Answer save failed:", err);
        }

        const images = await fetchImages(question);
        renderImages(images);
      } catch (error) {
        document.getElementById("responseContainer").innerHTML = "An error occurred. Try again later.";
        console.error(error);
      }
    });
  </script>
</body>
</html>
